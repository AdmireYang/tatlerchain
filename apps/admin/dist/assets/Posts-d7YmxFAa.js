import{d as M,a as j,q as F,e as u,f as p,o as c,g as l,i as s,w as i,y as m,j as n,V as Y,t as x,v as k,W as q,X as G,A as O,D as v,S as W,Y as X,Z as b,E as d}from"./index-CZtEAQEH.js";import{u as Z,C as J,g as K}from"./index-DdHaoOEa.js";import{u as Q}from"./useTable-CbtuGw_t.js";import{L as ee,s as te}from"./ListSkeleton-DC3X_gDe.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"posts-page"},ne={class:"page-header"},ae={key:1},le={key:2,class:"post-list"},ie={class:"post-image-wrapper"},re={class:"image-error"},ce={class:"post-content"},de={class:"post-header"},ue=["title","onClick"],pe={key:0,class:"post-excerpt"},_e={class:"post-meta"},me={class:"post-category"},ge={class:"post-views"},fe={class:"post-actions"},ve={key:3,class:"pagination-wrapper"},Ce=M({__name:"Posts",setup(he){const E=j(),C=Z();function P(o){return J[o]||o||"未分类"}const{data:h,total:S,loading:z,page:y,pageSize:g,fetchData:f,handlePageChange:U,handlePageSizeChange:$}=Q(K);function B(){E.push("/posts/create")}function D(o){E.push(`/posts/edit/${o}`)}function w(o){const r=`http://8.153.15.139/post/${o}`;window.open(r,"_blank")}async function I(o){const r=`http://8.153.15.139/posts/${o}`;try{await navigator.clipboard.writeText(r),d.success("链接已复制到剪贴板")}catch{const a=document.createElement("textarea");a.value=r,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select();try{document.execCommand("copy"),d.success("链接已复制到剪贴板")}catch{d.error("复制失败，请手动复制")}document.body.removeChild(a)}}async function L(o,e){try{e==="PUBLISHED"?(await C.update(o,{status:"DRAFT"}),d.success("已取消在官网展示"),f()):(await C.publish(o),d.success("已发布到官网"),f())}catch{d.error("操作失败")}}async function T(o){if(await te("这篇推文"))try{await C.remove(o),d.success("删除成功"),f()}catch{d.error("删除失败")}}return F(()=>{f()}),(o,e)=>{const r=u("ElIcon"),a=u("ElButton"),V=u("ElEmpty"),A=u("ElImage"),N=u("ElCheckbox"),R=u("ElPagination"),H=u("ElCard");return c(),p("div",oe,[l("div",ne,[e[3]||(e[3]=l("h1",{class:"text-2xl font-bold"},"推文管理",-1)),s(a,{type:"primary",onClick:B},{default:i(()=>[s(r,null,{default:i(()=>[s(n(Y))]),_:1}),e[2]||(e[2]=m(" 新建推文 ",-1))]),_:1})]),s(H,{class:"list-card",shadow:"never"},{default:i(()=>[n(z)?(c(),x(ee,{key:0,count:n(g)},null,8,["count"])):n(h).length===0?(c(),p("div",ae,[s(V,{description:"暂无推文数据"})])):(c(),p("div",le,[(c(!0),p(q,null,G(n(h),t=>(c(),p("div",{key:t.id,class:"post-card"},[l("div",ie,[s(A,{src:t.coverImage,fit:"cover",class:"post-image"},{error:i(()=>[l("div",re,[s(r,null,{default:i(()=>[s(n(O))]),_:1})])]),_:1},8,["src"])]),l("div",ce,[l("div",de,[l("div",{class:"post-title",title:t.title,onClick:_=>w(t.slug)},v(t.title),9,ue),t.excerpt?(c(),p("div",pe,v(t.excerpt),1)):k("",!0),l("div",_e,[s(N,{"model-value":t.status==="PUBLISHED",onChange:_=>L(t.id,t.status),label:"在官网展示"},null,8,["model-value","onChange"]),l("span",me,v(P(t.category)),1),l("span",ge,"浏览 "+v(t.viewCount),1)])])]),l("div",fe,[s(a,{size:"small",onClick:_=>D(t.id)},{default:i(()=>[...e[4]||(e[4]=[m("编辑",-1)])]),_:1},8,["onClick"]),t.status==="PUBLISHED"?(c(),x(a,{key:0,size:"small",onClick:_=>w(t.slug)},{default:i(()=>[s(r,null,{default:i(()=>[s(n(W))]),_:1}),e[5]||(e[5]=m(" 预览 ",-1))]),_:1},8,["onClick"])):k("",!0),s(a,{size:"small",onClick:_=>I(t.slug)},{default:i(()=>[s(r,null,{default:i(()=>[s(n(X))]),_:1}),e[6]||(e[6]=m(" 复制链接 ",-1))]),_:1},8,["onClick"]),s(a,{size:"small",type:"danger",onClick:_=>T(t.id)},{default:i(()=>[...e[7]||(e[7]=[m("删除",-1)])]),_:1},8,["onClick"])])]))),128))])),n(h).length>0?(c(),p("div",ve,[s(R,{"current-page":n(y),"onUpdate:currentPage":e[0]||(e[0]=t=>b(y)?y.value=t:null),"page-size":n(g),"onUpdate:pageSize":e[1]||(e[1]=t=>b(g)?g.value=t:null),total:n(S),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:n(U),onSizeChange:n($)},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])):k("",!0)]),_:1})])}}}),be=se(Ce,[["__scopeId","data-v-d3199b10"]]);export{be as default};
