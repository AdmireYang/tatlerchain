import{v as B,r as g,l as q,h as I,ab as U,y as A,z as w,D as u,C as o,aD as N,aB as S,c as C,j as M,ac as j,B as T,E as k,M as z,R as L,Q as E}from"./vue-vendor-CaWn4O-h.js";import{I as O}from"./ImageUpload-xFTIEZdc.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DBOFIeWp.js";import{u as P}from"./ad-4foiNQeh.js";import{E as n}from"./element-plus-Cl1iFrzV.js";import"./ad-BecHS-Qo.js";const Q=B({__name:"AdForm",props:{modelValue:{default:()=>({})}},emits:["update:modelValue"],setup(x,{expose:V,emit:m}){const r=x,v=m,d=g(),e=q({title:"",category:"",imageUrl:"",linkUrl:"",...r.modelValue});I(()=>r.modelValue,t=>{t&&Object.assign(e,{title:t.title||"",category:t.category||"",imageUrl:t.imageUrl||"",linkUrl:t.linkUrl||""})},{immediate:!0});const _={title:[{required:!0,message:"请输入广告标题",trigger:"blur"},{max:50,message:"标题不能超过50个字符",trigger:"blur"}],category:[{required:!0,message:"请输入广告分类",trigger:"blur"}],imageUrl:[{required:!0,message:"请上传广告图片",trigger:"change"}],linkUrl:[{required:!0,message:"请输入链接地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]};I(()=>e,()=>{v("update:modelValue",{...e})},{deep:!0});async function c(){if(!d.value)return!1;try{return await d.value.validate(),!0}catch{return!1}}function p(){var t;(t=d.value)==null||t.resetFields()}return V({validate:c,resetForm:p}),(t,s)=>{const y=U("ElInput"),f=U("ElFormItem"),h=U("ElForm");return w(),A(h,{ref_key:"formRef",ref:d,model:e,rules:_,"label-width":"120px"},{default:u(()=>[o(f,{label:"标题",prop:"title"},{default:u(()=>[o(y,{modelValue:e.title,"onUpdate:modelValue":s[0]||(s[0]=a=>e.title=a),placeholder:"请输入广告标题",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(f,{label:"分类",prop:"category"},{default:u(()=>[o(y,{modelValue:e.category,"onUpdate:modelValue":s[1]||(s[1]=a=>e.category=a),placeholder:"请输入广告分类"},null,8,["modelValue"])]),_:1}),o(f,{label:"广告图片",prop:"imageUrl"},{default:u(()=>[o(O,{modelValue:e.imageUrl,"onUpdate:modelValue":s[2]||(s[2]=a=>e.imageUrl=a)},null,8,["modelValue"])]),_:1}),o(f,{label:"链接地址",prop:"linkUrl"},{default:u(()=>[o(y,{modelValue:e.linkUrl,"onUpdate:modelValue":s[3]||(s[3]=a=>e.linkUrl=a),placeholder:"请输入链接地址",type:"url"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),$=F(Q,[["__scopeId","data-v-51806e20"]]),G={class:"ad-edit-page"},H={class:"page-header"},J={class:"text-2xl font-bold"},K={class:"actions"},W=B({__name:"AdEdit",setup(x){const V=N(),m=S(),r=P(),v=g(),d=g(!1),e=g(!1),_=g(!1),c=g({title:"",category:"",imageUrl:"",linkUrl:""}),p=C(()=>!!V.params.id),t=C(()=>V.params.id);async function s(){if(p.value){d.value=!0;try{const a=await r.fetchAdById(t.value);c.value={title:a.title,category:a.category,imageUrl:a.imageUrl,linkUrl:a.linkUrl}}catch{n.error("加载广告失败"),m.push("/ads")}finally{d.value=!1}}}async function y(){var l;if(!await((l=v.value)==null?void 0:l.validate())){n.warning("请填写必填字段");return}e.value=!0;try{const i={...c.value,status:"INACTIVE"};p.value?(await r.update(t.value,i),n.success("保存成功")):(await r.create(i),n.success("创建成功"),m.push("/ads"))}catch{n.error(p.value?"保存失败":"创建失败")}finally{e.value=!1}}async function f(){var l;if(!await((l=v.value)==null?void 0:l.validate())){n.warning("请填写必填字段");return}_.value=!0;try{const i=c.value;if(p.value)await r.update(t.value,i),await r.publish(t.value),n.success("发布成功"),m.push("/ads");else{const b=await r.create(i);await r.publish(b.id),n.success("发布成功"),m.push("/ads")}}catch{n.error("发布失败")}finally{_.value=!1}}function h(){m.push("/ads")}return M(()=>{s()}),(a,l)=>{const i=U("ElButton"),b=U("ElCard"),R=j("loading");return w(),T("div",G,[k("div",H,[k("h1",J,L(p.value?"编辑广告":"新建广告"),1),k("div",K,[o(i,{onClick:h},{default:u(()=>[...l[1]||(l[1]=[E("取消",-1)])]),_:1}),o(i,{type:"default",loading:e.value,onClick:y},{default:u(()=>[...l[2]||(l[2]=[E(" 保存草稿 ",-1)])]),_:1},8,["loading"]),o(i,{type:"primary",loading:_.value,onClick:f},{default:u(()=>[...l[3]||(l[3]=[E(" 发布 ",-1)])]),_:1},8,["loading"])])]),z((w(),A(b,{shadow:"never"},{default:u(()=>[o($,{ref_key:"formRef",ref:v,modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=D=>c.value=D)},null,8,["modelValue"])]),_:1})),[[R,d.value]])])}}}),oe=F(W,[["__scopeId","data-v-bd7fd96f"]]);export{oe as default};
