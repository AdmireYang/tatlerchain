import{v as j,aB as F,j as M,ab as u,B as p,z as c,E as l,C as s,D as i,Q as _,u as o,y as x,O as k,J as A,a5 as J,R as v,k as b}from"./vue-vendor-CaWn4O-h.js";import{n as O,p as Q,v as q,o as G,E as d}from"./element-plus-Cl1iFrzV.js";import"./index-Bq8XV1Pd.js";import{u as K,g as W}from"./post-9jc_PLcI.js";import{u as X}from"./useTable-Dn0_eMR9.js";import{L as Y,s as Z}from"./ListSkeleton-C3_RQHQc.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"posts-page"},se={class:"page-header"},oe={key:1},ae={key:2,class:"post-list"},ne={class:"post-image-wrapper"},le={class:"image-error"},ie={class:"post-content"},re={class:"post-header"},ce=["title","onClick"],de={key:0,class:"post-excerpt"},ue={class:"post-meta"},pe={class:"post-category"},me={class:"post-views"},_e={class:"post-actions"},ge={key:3,class:"pagination-wrapper"},fe=j({__name:"Posts",setup(ve){const E=F(),h=K(),{data:C,total:z,loading:P,page:y,pageSize:g,fetchData:f,handlePageChange:S,handlePageSizeChange:B}=X(W);function U(){E.push("/posts/create")}function $(n){E.push(`/posts/edit/${n}`)}function w(n){const r=`http://localhost:3004/post/${n}`;window.open(r,"_blank")}async function D(n){const r=`http://localhost:3004/posts/${n}`;try{await navigator.clipboard.writeText(r),d.success("链接已复制到剪贴板")}catch{const a=document.createElement("textarea");a.value=r,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select();try{document.execCommand("copy"),d.success("链接已复制到剪贴板")}catch{d.error("复制失败，请手动复制")}document.body.removeChild(a)}}async function I(n,e){try{e==="PUBLISHED"?(await h.update(n,{status:"DRAFT"}),d.success("已取消在官网展示"),f()):(await h.publish(n),d.success("已发布到官网"),f())}catch{d.error("操作失败")}}async function L(n){if(await Z("这篇推文"))try{await h.remove(n),d.success("删除成功"),f()}catch{d.error("删除失败")}}return M(()=>{f()}),(n,e)=>{const r=u("ElIcon"),a=u("ElButton"),T=u("ElEmpty"),N=u("ElImage"),R=u("ElCheckbox"),V=u("ElPagination"),H=u("ElCard");return c(),p("div",te,[l("div",se,[e[3]||(e[3]=l("h1",{class:"text-2xl font-bold"},"推文管理",-1)),s(a,{type:"primary",onClick:U},{default:i(()=>[s(r,null,{default:i(()=>[s(o(O))]),_:1}),e[2]||(e[2]=_(" 新建推文 ",-1))]),_:1})]),s(H,{class:"list-card",shadow:"never"},{default:i(()=>[o(P)?(c(),x(Y,{key:0,count:o(g)},null,8,["count"])):o(C).length===0?(c(),p("div",oe,[s(T,{description:"暂无推文数据"})])):(c(),p("div",ae,[(c(!0),p(A,null,J(o(C),t=>(c(),p("div",{key:t.id,class:"post-card"},[l("div",ne,[s(N,{src:t.coverImage,fit:"cover",class:"post-image"},{error:i(()=>[l("div",le,[s(r,null,{default:i(()=>[s(o(Q))]),_:1})])]),_:1},8,["src"])]),l("div",ie,[l("div",re,[l("div",{class:"post-title",title:t.title,onClick:m=>w(t.slug)},v(t.title),9,ce),t.excerpt?(c(),p("div",de,v(t.excerpt),1)):k("",!0),l("div",ue,[s(R,{"model-value":t.status==="PUBLISHED",onChange:m=>I(t.id,t.status),label:"在官网展示"},null,8,["model-value","onChange"]),l("span",pe,v(t.category),1),l("span",me,"浏览 "+v(t.viewCount),1)])])]),l("div",_e,[s(a,{size:"small",onClick:m=>$(t.id)},{default:i(()=>[...e[4]||(e[4]=[_("编辑",-1)])]),_:1},8,["onClick"]),t.status==="PUBLISHED"?(c(),x(a,{key:0,size:"small",onClick:m=>w(t.slug)},{default:i(()=>[s(r,null,{default:i(()=>[s(o(q))]),_:1}),e[5]||(e[5]=_(" 预览 ",-1))]),_:1},8,["onClick"])):k("",!0),s(a,{size:"small",onClick:m=>D(t.slug)},{default:i(()=>[s(r,null,{default:i(()=>[s(o(G))]),_:1}),e[6]||(e[6]=_(" 复制链接 ",-1))]),_:1},8,["onClick"]),s(a,{size:"small",type:"danger",onClick:m=>L(t.id)},{default:i(()=>[...e[7]||(e[7]=[_("删除",-1)])]),_:1},8,["onClick"])])]))),128))])),o(C).length>0?(c(),p("div",ge,[s(V,{"current-page":o(y),"onUpdate:currentPage":e[0]||(e[0]=t=>b(y)?y.value=t:null),"page-size":o(g),"onUpdate:pageSize":e[1]||(e[1]=t=>b(g)?g.value=t:null),total:o(z),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:o(S),onSizeChange:o(B)},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])):k("",!0)]),_:1})])}}}),be=ee(fe,[["__scopeId","data-v-21c8bb05"]]);export{be as default};
