import{p as M,y as D,E as f}from"./element-plus-B8SKDpVE.js";import{s as N}from"./index-DNHOLSe2.js";import{v as R,r as i,h as L,ab as c,B as y,z as v,E as I,O as V,C as d,D as h,Q as W,R as x,y as F,F as H,u as E}from"./vue-vendor-C3C-az8a.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";function $(e,p){const t=new FormData;return t.append("file",e),N.post("/backstage/upload/image",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{if(p&&a.total){const g=Math.round(a.loaded*100/a.total);p(g)}}})}const q={class:"image-upload"},A={class:"upload-area"},O={key:0,class:"image-preview"},P={class:"image-error"},Q={key:1,class:"upload-tip"},j=R({__name:"ImageUpload",props:{modelValue:{default:""},placeholder:{default:"请输入图片 URL 或上传图片"},accept:{default:"image/*"},maxSize:{default:5},previewWidth:{default:"200px"},previewHeight:{default:"120px"},clearable:{type:Boolean,default:!0},tip:{default:""}},emits:["update:modelValue","upload-success","upload-error"],setup(e,{emit:p}){const t=e,a=p,g=i(),o=i(t.modelValue),r=i(!1),m=i(0),b=i("");L(()=>t.modelValue,l=>{o.value=l});function w(l){a("update:modelValue",l)}function U(l){return l.type.startsWith("image/")?l.size/1024/1024<t.maxSize?!0:(f.error(`图片大小不能超过 ${t.maxSize}MB`),!1):(f.error("只能上传图片文件"),!1)}async function k(l){const s=l.file;r.value=!0,m.value=0;try{const u=(await $(s,_=>{m.value=_})).data.data.url;o.value=u,a("update:modelValue",u),a("upload-success",u),f.success("上传成功")}catch(n){console.error("上传失败:",n),a("upload-error",n),f.error("上传失败")}finally{r.value=!1,m.value=0}}function z(){o.value="",a("update:modelValue","")}return(l,s)=>{const n=c("ElInput"),u=c("ElButton"),_=c("ElUpload"),B=c("ElIcon"),C=c("ElImage");return v(),y("div",q,[I("div",A,[d(n,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=S=>o.value=S),placeholder:e.placeholder,disabled:r.value,onInput:w},null,8,["modelValue","placeholder","disabled"]),d(_,{ref_key:"uploadRef",ref:g,action:b.value,"show-file-list":!1,"before-upload":U,"http-request":k,disabled:r.value},{default:h(()=>[d(u,{type:"primary",loading:r.value},{default:h(()=>[W(x(r.value?`上传中 ${m.value}%`:"上传图片"),1)]),_:1},8,["loading"])]),_:1},8,["action","disabled"])]),o.value?(v(),y("div",O,[d(C,{src:o.value,fit:"cover",style:H({width:e.previewWidth,height:e.previewHeight})},{error:h(()=>[I("div",P,[d(B,null,{default:h(()=>[d(E(M))]),_:1}),s[1]||(s[1]=I("span",null,"加载失败",-1))])]),_:1},8,["src","style"]),e.clearable?(v(),F(u,{key:0,class:"clear-btn",type:"danger",size:"small",circle:"",icon:E(D),onClick:z},null,8,["icon"])):V("",!0)])):V("",!0),e.tip?(v(),y("div",Q,x(e.tip),1)):V("",!0)])}}}),Y=T(j,[["__scopeId","data-v-cdcef7f5"]]);export{Y as I};
