import{aa as x,I as de,r as w,d as ie,u as ue,c as pe,b as O,m as me,e as i,a7 as ce,f as V,o as f,h as F,i as a,w as l,x as u,s as p,U as fe,a5 as ge,q,p as A,t as j,Y as G,G as ve,E as k}from"./index-CoN5ggrH.js";import{u as ye}from"./useTable-DJhhaOIC.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";function L(r){return x.get("/backstage/users",{params:r})}function _e(r){return x.get(`/backstage/users/${r}`)}function Ee(r){return x.post("/backstage/users",r)}function be(r,m){return x.put(`/backstage/users/${r}`,m)}function Ce(r){return x.delete(`/backstage/users/${r}`)}const he=de("user",()=>{const r=w([]),m=w(null),g=w(!1);async function S(n){g.value=!0;try{const d=await L(n);return r.value=Array.isArray(d.data.data)?d.data.data:[],d.data}finally{g.value=!1}}async function v(n){g.value=!0;try{const d=await _e(n);return m.value=d.data.data,d.data.data}finally{g.value=!1}}async function U(n){return(await Ee(n)).data.data}async function T(n,d){return(await be(n,d)).data.data}async function z(n){await Ce(n)}return{users:r,currentUser:m,loading:g,fetchUsers:S,fetchUserById:v,create:U,update:T,remove:z}}),Ve={class:"users-page"},ke={class:"page-header"},xe={key:0,class:"password-text"},Ue={key:1,class:"password-empty"},De={key:0,class:"pagination-wrapper"},Ie={key:0,style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},Se=ie({__name:"Users",setup(r){const m=he(),g=ue(),S=pe(()=>{var s;return(s=g.user)==null?void 0:s.id}),v=O({role:void 0}),{data:U,total:T,loading:z,page:n,pageSize:d,fetchData:_,handlePageChange:Y,handlePageSizeChange:H}=ye(s=>L({...s,...v})),E=w(!1),c=w(!1),B=w(!1),D=w(),t=O({id:"",name:"",email:"",password:"",role:"EDITOR"}),J={email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{validator:(s,e,h)=>{!c.value&&!e?h(new Error("请输入密码")):e&&e!=="******"&&e.length<6?h(new Error("密码长度至少6位")):h()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},K=s=>new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),Q=()=>{n.value=1,_()},W=()=>{v.role=void 0,n.value=1,_()},X=()=>{c.value=!1,E.value=!0},Z=s=>{c.value=!0,t.id=s.id,t.name=s.name,t.email=s.email,t.password=s.displayPassword,t.role=s.role,E.value=!0},ee=async s=>{try{await ve.confirm(`确定要删除账号"${s.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.remove(s.id),k.success("删除成功"),_()}catch(e){e!=="cancel"&&k.error(e.message||"删除失败")}},ae=async()=>{if(D.value)try{if(await D.value.validate(),B.value=!0,c.value){const s={name:t.name,email:t.email,role:t.role};t.password&&t.password!=="******"&&(s.password=t.password),await m.update(t.id,s),k.success("更新成功")}else await m.create({name:t.name,email:t.email,password:t.password,role:t.role}),k.success("创建成功");E.value=!1,_()}catch(s){s!==!1&&k.error(s.message||(c.value?"更新失败":"创建失败"))}finally{B.value=!1}},te=()=>{var s;(s=D.value)==null||s.resetFields(),t.id="",t.name="",t.email="",t.password="",t.role="EDITOR"};return me(()=>{_()}),(s,e)=>{const h=i("ElIcon"),y=i("ElButton"),I=i("ElOption"),N=i("ElSelect"),b=i("ElFormItem"),R=i("ElForm"),$=i("ElCard"),C=i("ElTableColumn"),M=i("ElTag"),le=i("ElTable"),oe=i("ElPagination"),P=i("ElInput"),se=i("ElDialog"),ne=ce("loading");return f(),V("div",Ve,[F("div",ke,[e[10]||(e[10]=F("h1",{class:"text-2xl font-bold"},"账号管理",-1)),a(y,{type:"primary",onClick:X},{default:l(()=>[a(h,null,{default:l(()=>[a(p(fe))]),_:1}),e[9]||(e[9]=u(" 新建账号 ",-1))]),_:1})]),a($,{class:"filter-card",shadow:"never"},{default:l(()=>[a(R,{inline:!0,model:v},{default:l(()=>[a(b,{label:"角色"},{default:l(()=>[a(N,{modelValue:v.role,"onUpdate:modelValue":e[0]||(e[0]=o=>v.role=o),placeholder:"全部角色",clearable:"",style:{width:"150px"}},{default:l(()=>[a(I,{label:"管理员",value:"ADMIN"}),a(I,{label:"编辑",value:"EDITOR"})]),_:1},8,["modelValue"])]),_:1}),a(b,null,{default:l(()=>[a(y,{type:"primary",onClick:Q},{default:l(()=>[...e[11]||(e[11]=[u("查询",-1)])]),_:1}),a(y,{onClick:W},{default:l(()=>[...e[12]||(e[12]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a($,{class:"list-card",shadow:"never"},{default:l(()=>[ge((f(),A(le,{data:p(U),stripe:""},{default:l(()=>[a(C,{prop:"email",label:"邮箱","min-width":"180"}),a(C,{prop:"name",label:"用户名","min-width":"120"}),a(C,{prop:"displayPassword",label:"初始密码",width:"150"},{default:l(({row:o})=>[o.displayPassword?(f(),V("span",xe,j(o.displayPassword),1)):(f(),V("span",Ue,"已修改"))]),_:1}),a(C,{prop:"role",label:"角色",width:"100"},{default:l(({row:o})=>[o.role==="ADMIN"?(f(),A(M,{key:0,type:"danger"},{default:l(()=>[...e[13]||(e[13]=[u("管理员",-1)])]),_:1})):(f(),A(M,{key:1,type:"info"},{default:l(()=>[...e[14]||(e[14]=[u("编辑",-1)])]),_:1}))]),_:1}),a(C,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:o})=>[u(j(K(o.createdAt)),1)]),_:1}),a(C,{label:"操作",width:"180",fixed:"right"},{default:l(({row:o})=>[a(y,{size:"small",type:"primary",text:"",onClick:re=>Z(o)},{default:l(()=>[...e[15]||(e[15]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(y,{size:"small",type:"danger",text:"",disabled:o.id===S.value,onClick:re=>ee(o)},{default:l(()=>[...e[16]||(e[16]=[u(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[ne,p(z)]]),p(U).length>0?(f(),V("div",De,[a(oe,{"current-page":p(n),"onUpdate:currentPage":e[1]||(e[1]=o=>G(n)?n.value=o:null),"page-size":p(d),"onUpdate:pageSize":e[2]||(e[2]=o=>G(d)?d.value=o:null),total:p(T),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:p(Y),onSizeChange:p(H)},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])):q("",!0)]),_:1}),a(se,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=o=>E.value=o),title:c.value?"编辑账号":"新建账号",width:"500px",onClose:te},{footer:l(()=>[a(y,{onClick:e[7]||(e[7]=o=>E.value=!1)},{default:l(()=>[...e[17]||(e[17]=[u("取消",-1)])]),_:1}),a(y,{type:"primary",loading:B.value,onClick:ae},{default:l(()=>[...e[18]||(e[18]=[u("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(R,{ref_key:"formRef",ref:D,model:t,rules:J,"label-width":"80px","label-position":"right"},{default:l(()=>[a(b,{label:"账号",prop:"email"},{default:l(()=>[a(P,{modelValue:t.email,"onUpdate:modelValue":e[3]||(e[3]=o=>t.email=o),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),a(b,{label:"用户名",prop:"name"},{default:l(()=>[a(P,{modelValue:t.name,"onUpdate:modelValue":e[4]||(e[4]=o=>t.name=o),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(b,{label:"密码",prop:"password"},{default:l(()=>[a(P,{modelValue:t.password,"onUpdate:modelValue":e[5]||(e[5]=o=>t.password=o),type:"password",placeholder:c.value?"不修改请保持默认值":"请输入密码","show-password":""},null,8,["modelValue","placeholder"]),c.value?(f(),V("div",Ie," 提示：如需修改密码请清空后重新输入，否则保持默认值不修改 ")):q("",!0)]),_:1}),a(b,{label:"角色",prop:"role"},{default:l(()=>[a(N,{modelValue:t.role,"onUpdate:modelValue":e[6]||(e[6]=o=>t.role=o),placeholder:"请选择角色",style:{width:"100%"}},{default:l(()=>[a(I,{label:"管理员",value:"ADMIN"}),a(I,{label:"编辑",value:"EDITOR"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Pe=we(Se,[["__scopeId","data-v-2c9830aa"]]);export{Pe as default};
