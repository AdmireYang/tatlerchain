import{d as M,a as F,m as Y,e as u,f as p,o as c,h as l,i as s,w as i,x as m,s as n,U as j,p as x,q as k,V as q,W as G,z as O,t as h,R as W,X,Y as b,E as d}from"./index-B14LQPlx.js";import{u as J,C as K,g as Q}from"./index-DVTiSM6l.js";import{u as Z}from"./useTable-DR8068x7.js";import{L as ee,s as te}from"./ListSkeleton-DUj-rIQg.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"posts-page"},ne={class:"page-header"},ae={key:1},le={key:2,class:"post-list"},ie={class:"post-image-wrapper"},re={class:"image-error"},ce={class:"post-content"},de={class:"post-header"},ue=["title","onClick"],pe={key:0,class:"post-excerpt"},_e={class:"post-meta"},me={class:"post-category"},ge={class:"post-views"},fe={class:"post-actions"},he={key:3,class:"pagination-wrapper"},ve=M({__name:"Posts",setup(Ce){const E=F(),v=J();function z(o){return K[o]||o||"未分类"}const{data:C,total:P,loading:S,page:y,pageSize:g,fetchData:f,handlePageChange:U,handlePageSizeChange:$}=Z(Q);function B(){E.push("/posts/create")}function I(o){E.push(`/posts/edit/${o}`)}function w(o){const r=`http://8.153.15.139/post/${o}`;window.open(r,"_blank")}async function D(o){const r=`http://8.153.15.139/posts/${o}`;try{await navigator.clipboard.writeText(r),d.success("链接已复制到剪贴板")}catch{const a=document.createElement("textarea");a.value=r,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select();try{document.execCommand("copy"),d.success("链接已复制到剪贴板")}catch{d.error("复制失败，请手动复制")}document.body.removeChild(a)}}async function L(o,e){try{e==="PUBLISHED"?(await v.update(o,{status:"DRAFT"}),d.success("已取消在官网展示"),f()):(await v.publish(o),d.success("已发布到官网"),f())}catch{d.error("操作失败")}}async function T(o){if(await te("这篇推文"))try{await v.remove(o),d.success("删除成功"),f()}catch{d.error("删除失败")}}return Y(()=>{f()}),(o,e)=>{const r=u("ElIcon"),a=u("ElButton"),R=u("ElEmpty"),V=u("ElImage"),N=u("ElCheckbox"),A=u("ElPagination"),H=u("ElCard");return c(),p("div",oe,[l("div",ne,[e[3]||(e[3]=l("h1",{class:"text-2xl font-bold"},"推文管理",-1)),s(a,{type:"primary",onClick:B},{default:i(()=>[s(r,null,{default:i(()=>[s(n(j))]),_:1}),e[2]||(e[2]=m(" 新建推文 ",-1))]),_:1})]),s(H,{class:"list-card",shadow:"never"},{default:i(()=>[n(S)?(c(),x(ee,{key:0,count:n(g)},null,8,["count"])):n(C).length===0?(c(),p("div",ae,[s(R,{description:"暂无推文数据"})])):(c(),p("div",le,[(c(!0),p(q,null,G(n(C),t=>(c(),p("div",{key:t.id,class:"post-card"},[l("div",ie,[s(V,{src:t.coverImage,fit:"cover",class:"post-image"},{error:i(()=>[l("div",re,[s(r,null,{default:i(()=>[s(n(O))]),_:1})])]),_:1},8,["src"])]),l("div",ce,[l("div",de,[l("div",{class:"post-title",title:t.title,onClick:_=>w(t.slug)},h(t.title),9,ue),t.excerpt?(c(),p("div",pe,h(t.excerpt),1)):k("",!0),l("div",_e,[s(N,{"model-value":t.status==="PUBLISHED",onChange:_=>L(t.id,t.status),label:"在官网展示"},null,8,["model-value","onChange"]),l("span",me,h(z(t.category)),1),l("span",ge,"浏览 "+h(t.viewCount),1)])])]),l("div",fe,[s(a,{size:"small",onClick:_=>I(t.id)},{default:i(()=>[...e[4]||(e[4]=[m("编辑",-1)])]),_:1},8,["onClick"]),t.status==="PUBLISHED"?(c(),x(a,{key:0,size:"small",onClick:_=>w(t.slug)},{default:i(()=>[s(r,null,{default:i(()=>[s(n(W))]),_:1}),e[5]||(e[5]=m(" 预览 ",-1))]),_:1},8,["onClick"])):k("",!0),s(a,{size:"small",onClick:_=>D(t.slug)},{default:i(()=>[s(r,null,{default:i(()=>[s(n(X))]),_:1}),e[6]||(e[6]=m(" 复制链接 ",-1))]),_:1},8,["onClick"]),s(a,{size:"small",type:"danger",onClick:_=>T(t.id)},{default:i(()=>[...e[7]||(e[7]=[m("删除",-1)])]),_:1},8,["onClick"])])]))),128))])),n(C).length>0?(c(),p("div",he,[s(A,{"current-page":n(y),"onUpdate:currentPage":e[0]||(e[0]=t=>b(y)?y.value=t:null),"page-size":n(g),"onUpdate:pageSize":e[1]||(e[1]=t=>b(g)?g.value=t:null),total:n(P),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:n(U),onSizeChange:n($)},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])):k("",!0)]),_:1})])}}}),be=se(ve,[["__scopeId","data-v-d3199b10"]]);export{be as default};
