import{ax as F,r as x,v as T,c as I,ab as c,y as b,z as _,D as e,E as h,F as G,C as t,P as Q,R as k,aE as q,j as N,n as L,_ as H,W as J,h as V,B as P,aB as O,u as y,Q as E,O as R}from"./vue-vendor-CaWn4O-h.js";import{g as B}from"./index-DBOFIeWp.js";import{b as K,h as M,j as X,v as Y,k as Z,m as tt,E as U}from"./element-plus-Cl1iFrzV.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i as et}from"./echarts-C3W-oE5n.js";const at=()=>B("/backstage/dashboard"),st=()=>B("/backstage/dashboard/posts"),lt=()=>B("/backstage/dashboard/ads"),ot=F("dashboard",()=>{const l=x(null),u=x(null),s=x(!1),n=x(null);return{postsStats:l,adsStats:u,loading:s,error:n,fetchOverview:async()=>{s.value=!0,n.value=null;try{const a=await at();l.value=a.posts,u.value=a.ads}catch(a){const o=a instanceof Error?a.message:"获取统计数据失败";throw n.value=o,a}finally{s.value=!1}},fetchPostsStats:async()=>{s.value=!0,n.value=null;try{const a=await st();l.value=a}catch(a){const o=a instanceof Error?a.message:"获取推文统计数据失败";throw n.value=o,a}finally{s.value=!1}},fetchAdsStats:async()=>{s.value=!0,n.value=null;try{const a=await lt();u.value=a}catch(a){const o=a instanceof Error?a.message:"获取广告统计数据失败";throw n.value=o,a}finally{s.value=!1}},reset:()=>{l.value=null,u.value=null,s.value=!1,n.value=null}}}),nt={class:"stat-card-content"},rt={class:"stat-info"},dt={class:"stat-title"},it={class:"stat-value"},ct=T({__name:"StatCard",props:{title:{},value:{},icon:{},color:{default:"#409eff"}},setup(l){const u=l,s=I(()=>typeof u.value=="number"?u.value.toLocaleString():u.value);return(n,i)=>{const r=c("ElIcon"),d=c("ElCard");return _(),b(d,{class:"stat-card","body-style":{padding:"20px"}},{default:e(()=>[h("div",nt,[h("div",{class:"stat-icon",style:G({backgroundColor:l.color+"20",color:l.color})},[t(r,{size:32},{default:e(()=>[(_(),b(Q(l.icon)))]),_:1})],4),h("div",rt,[h("div",dt,k(l.title),1),h("div",it,k(s.value),1)])])]),_:1})}}}),C=D(ct,[["__scopeId","data-v-a5864d28"]]),ut=T({__name:"TrendChart",props:{data:{},type:{default:"line"},height:{default:"300px"},color:{default:"#409eff"}},setup(l,{expose:u}){q(f=>({v8540e038:f.height}));const s=l,n=x();let i=null;const r=()=>{if(!n.value)return;i&&i.dispose(),i=et(n.value);const f={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:s.data.labels,boundaryGap:s.type==="bar",axisLine:{lineStyle:{color:"#e4e7ed"}},axisLabel:{color:"#606266"}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#606266"},splitLine:{lineStyle:{color:"#e4e7ed",type:"dashed"}}},series:[{name:s.data.name||"数据",type:s.type,data:s.data.values,smooth:s.type==="line",itemStyle:{color:s.color},areaStyle:s.type==="line"?{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:s.color+"40"},{offset:1,color:s.color+"00"}]}}:void 0}]};i.setOption(f)},d=()=>{i==null||i.resize()};return u({resize:d}),N(()=>{L(()=>{r(),window.addEventListener("resize",d)})}),H(()=>{L(()=>{d()})}),J(()=>{window.removeEventListener("resize",d),i&&(i.dispose(),i=null)}),V(()=>s.data,()=>{L(()=>{r()})},{deep:!0}),V(()=>s.type,()=>{L(()=>{r()})}),(f,a)=>(_(),P("div",{ref_key:"chartRef",ref:n,class:"trend-chart"},null,512))}}),pt=D(ut,[["__scopeId","data-v-4183b2ba"]]),ft={class:"posts-dashboard"},mt=T({__name:"PostsDashboard",props:{stats:{}},setup(l){const u=O(),s="http://8.153.15.139",n=l,i=I(()=>{var a;return!((a=n.stats)!=null&&a.trend)||n.stats.trend.length===0?null:{labels:n.stats.trend.map(o=>{const m=new Date(o.date);return`${m.getMonth()+1}/${m.getDate()}`}),values:n.stats.trend.map(o=>o.count),name:"发布数量"}}),r=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",d=(a,o)=>{const m=`${s}/post/${o||a}`;window.open(m,"_blank")},f=a=>{u.push(`/posts/edit/${a}`)};return(a,o)=>{const m=c("ElCol"),S=c("ElRow"),$=c("ElEmpty"),A=c("ElCard"),p=c("ElTableColumn"),g=c("ElTag"),z=c("ElButton"),j=c("ElTable");return _(),P("div",ft,[t(S,{gutter:16,class:"mb-4"},{default:e(()=>[t(m,{xs:24,sm:12,md:6},{default:e(()=>{var v;return[t(C,{title:"推文总数",value:((v=l.stats)==null?void 0:v.total)||0,icon:y(K),color:"#409eff"},null,8,["value","icon"])]}),_:1}),t(m,{xs:24,sm:12,md:6},{default:e(()=>{var v;return[t(C,{title:"已发布",value:((v=l.stats)==null?void 0:v.published)||0,icon:y(M),color:"#67c23a"},null,8,["value","icon"])]}),_:1}),t(m,{xs:24,sm:12,md:6},{default:e(()=>{var v;return[t(C,{title:"草稿",value:((v=l.stats)==null?void 0:v.draft)||0,icon:y(X),color:"#e6a23c"},null,8,["value","icon"])]}),_:1}),t(m,{xs:24,sm:12,md:6},{default:e(()=>{var v;return[t(C,{title:"总浏览量",value:((v=l.stats)==null?void 0:v.totalViews)||0,icon:y(Y),color:"#f56c6c"},null,8,["value","icon"])]}),_:1})]),_:1}),t(S,{gutter:16,class:"mb-4"},{default:e(()=>[t(m,{span:24},{default:e(()=>[t(A,null,{header:e(()=>[...o[0]||(o[0]=[h("div",{class:"card-header"},[h("span",null,"推文发布趋势（最近 7 天）")],-1)])]),default:e(()=>[i.value?(_(),b(pt,{key:0,data:i.value,type:"line",color:"#409eff",height:"300px"},null,8,["data"])):(_(),b($,{key:1,description:"暂无数据"}))]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(m,{span:24},{default:e(()=>[t(A,null,{header:e(()=>[...o[1]||(o[1]=[h("div",{class:"card-header"},[h("span",null,"最受欢迎的推文（Top 10）")],-1)])]),default:e(()=>{var v;return[(v=l.stats)!=null&&v.topPosts&&l.stats.topPosts.length>0?(_(),b(j,{key:0,data:l.stats.topPosts,stripe:""},{default:e(()=>[t(p,{type:"index",label:"排名",width:"80"}),t(p,{prop:"title",label:"标题","min-width":"200"}),t(p,{prop:"viewCount",label:"浏览量",width:"120",align:"right"},{default:e(({row:w})=>[t(g,{type:"danger"},{default:e(()=>[E(k(w.viewCount.toLocaleString()),1)]),_:2},1024)]),_:1}),t(p,{prop:"publishedAt",label:"发布时间",width:"180"},{default:e(({row:w})=>[E(k(r(w.publishedAt)),1)]),_:1}),t(p,{label:"操作",width:"150",fixed:"right"},{default:e(({row:w})=>[t(z,{type:"primary",size:"small",text:"",onClick:W=>d(w.id,w.slug)},{default:e(()=>[...o[2]||(o[2]=[E(" 预览 ",-1)])]),_:1},8,["onClick"]),t(z,{type:"primary",size:"small",text:"",onClick:W=>f(w.id)},{default:e(()=>[...o[3]||(o[3]=[E(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(_(),b($,{key:1,description:"暂无数据"}))]}),_:1})]),_:1})]),_:1})])}}}),vt=D(mt,[["__scopeId","data-v-9051873f"]]),_t={class:"ads-dashboard"},ht=T({__name:"AdsDashboard",props:{stats:{}},setup(l){const u=O(),s=r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",n=r=>{if(!r){U.warning("该广告没有设置链接");return}window.open(r,"_blank")},i=r=>{u.push(`/ads/edit/${r}`)};return(r,d)=>{const f=c("ElCol"),a=c("ElRow"),o=c("ElTableColumn"),m=c("ElButton"),S=c("ElTable"),$=c("ElEmpty"),A=c("ElCard");return _(),P("div",_t,[t(a,{gutter:16,class:"mb-4"},{default:e(()=>[t(f,{xs:24,sm:12,md:8},{default:e(()=>{var p;return[t(C,{title:"广告总数",value:((p=l.stats)==null?void 0:p.total)||0,icon:y(Z),color:"#409eff"},null,8,["value","icon"])]}),_:1}),t(f,{xs:24,sm:12,md:8},{default:e(()=>{var p;return[t(C,{title:"活跃广告",value:((p=l.stats)==null?void 0:p.active)||0,icon:y(M),color:"#67c23a"},null,8,["value","icon"])]}),_:1}),t(f,{xs:24,sm:12,md:8},{default:e(()=>{var p;return[t(C,{title:"总点击次数",value:((p=l.stats)==null?void 0:p.totalClicks)||0,icon:y(tt),color:"#e6a23c"},null,8,["value","icon"])]}),_:1})]),_:1}),t(a,{gutter:16},{default:e(()=>[t(f,{span:24},{default:e(()=>[t(A,null,{header:e(()=>[...d[0]||(d[0]=[h("div",{class:"card-header"},[h("span",null,"表现最好的广告（Top 10）")],-1)])]),default:e(()=>{var p;return[(p=l.stats)!=null&&p.topAds&&l.stats.topAds.length>0?(_(),b(S,{key:0,data:l.stats.topAds,stripe:""},{default:e(()=>[t(o,{type:"index",label:"排名",width:"80"}),t(o,{prop:"title",label:"标题","min-width":"200"}),t(o,{prop:"clickCount",label:"点击次数",width:"120",align:"right"},{default:e(({row:g})=>[E(k(g.clickCount.toLocaleString()),1)]),_:1}),t(o,{prop:"publishedAt",label:"发布时间",width:"180"},{default:e(({row:g})=>[E(k(s(g.publishedAt)),1)]),_:1}),t(o,{label:"操作",width:"150",fixed:"right"},{default:e(({row:g})=>[t(m,{type:"primary",size:"small",text:"",onClick:z=>n(g.linkUrl)},{default:e(()=>[...d[1]||(d[1]=[E(" 预览 ",-1)])]),_:1},8,["onClick"]),t(m,{type:"primary",size:"small",text:"",onClick:z=>i(g.id)},{default:e(()=>[...d[2]||(d[2]=[E(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(_(),b($,{key:1,description:"暂无数据"}))]}),_:1})]),_:1})]),_:1})])}}}),bt=D(ht,[["__scopeId","data-v-f8849e67"]]),yt={class:"dashboard-page"},gt=T({__name:"Dashboard",setup(l){const u=ot(),s=x("posts"),n=async()=>{try{await u.fetchOverview()}catch(r){U.error(r.message||"加载数据失败")}},i=r=>{console.log("切换到标签页:",r)};return N(()=>{n()}),(r,d)=>{const f=c("ElTabPane"),a=c("ElTabs");return _(),P("div",yt,[d[1]||(d[1]=h("h1",{class:"text-2xl font-bold mb-4"},"数据看板",-1)),t(a,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=o=>s.value=o),onTabChange:i},{default:e(()=>[t(f,{label:"推文看板",name:"posts"},{default:e(()=>[s.value==="posts"?(_(),b(vt,{key:0,stats:y(u).postsStats},null,8,["stats"])):R("",!0)]),_:1}),t(f,{label:"广告看板",name:"ads"},{default:e(()=>[s.value==="ads"?(_(),b(bt,{key:0,stats:y(u).adsStats},null,8,["stats"])):R("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),St=D(gt,[["__scopeId","data-v-9c645347"]]);export{St as default};
