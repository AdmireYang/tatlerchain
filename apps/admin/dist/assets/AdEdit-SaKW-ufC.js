import{d as A,r as f,b as q,P as I,e as U,t as F,o as b,w as d,i as s,p as N,a as S,c as C,q as M,a6 as P,f as T,g as w,a7 as j,D as L,y as E,E as i}from"./index-C6hz40a1.js";import{I as O}from"./ImageUpload-BUHjAujo.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{u as $}from"./ad-CP4iPPJZ.js";import"./ad-CbKy05Cp.js";const z=A({__name:"AdForm",props:{modelValue:{default:()=>({})}},emits:["update:modelValue"],setup(x,{expose:y,emit:c}){const o=x,g=c,n=f(),e=q({title:"",imageUrl:"",linkUrl:"",...o.modelValue});I(()=>o.modelValue,t=>{t&&Object.assign(e,{title:t.title||"",imageUrl:t.imageUrl||"",linkUrl:t.linkUrl||""})},{immediate:!0});const v={title:[{required:!0,message:"请输入广告标题",trigger:"blur"},{max:50,message:"标题不能超过50个字符",trigger:"blur"}],imageUrl:[{required:!0,message:"请上传广告图片",trigger:"change"}],linkUrl:[{required:!0,message:"请输入链接地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]};I(()=>e,()=>{g("update:modelValue",{...e})},{deep:!0});async function m(){if(!n.value)return!1;try{return await n.value.validate(),!0}catch{return!1}}function p(){var t;(t=n.value)==null||t.resetFields()}return y({validate:m,resetForm:p}),(t,u)=>{const V=U("ElInput"),_=U("ElFormItem"),h=U("ElForm");return b(),F(h,{ref_key:"formRef",ref:n,model:e,rules:v,"label-width":"120px"},{default:d(()=>[s(_,{label:"标题",prop:"title"},{default:d(()=>[s(V,{modelValue:e.title,"onUpdate:modelValue":u[0]||(u[0]=l=>e.title=l),placeholder:"请输入广告标题",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(_,{label:"广告图片",prop:"imageUrl"},{default:d(()=>[s(O,{modelValue:e.imageUrl,"onUpdate:modelValue":u[1]||(u[1]=l=>e.imageUrl=l)},null,8,["modelValue"])]),_:1}),s(_,{label:"链接地址",prop:"linkUrl"},{default:d(()=>[s(V,{modelValue:e.linkUrl,"onUpdate:modelValue":u[2]||(u[2]=l=>e.linkUrl=l),placeholder:"请输入链接地址",type:"url"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),G=B(z,[["__scopeId","data-v-d1193cd4"]]),H={class:"ad-edit-page"},J={class:"page-header"},K={class:"text-2xl font-bold"},Q={class:"actions"},W=A({__name:"AdEdit",setup(x){const y=N(),c=S(),o=$(),g=f(),n=f(!1),e=f(!1),v=f(!1),m=f({title:"",category:"",imageUrl:"",linkUrl:""}),p=C(()=>!!y.params.id),t=C(()=>y.params.id);async function u(){if(p.value){n.value=!0;try{const l=await o.fetchAdById(t.value);m.value={title:l.title,category:l.category,imageUrl:l.imageUrl,linkUrl:l.linkUrl}}catch{i.error("加载广告失败"),c.push("/ads")}finally{n.value=!1}}}async function V(){var a;if(!await((a=g.value)==null?void 0:a.validate())){i.warning("请填写必填字段");return}e.value=!0;try{const r={...m.value,status:"INACTIVE"};p.value?(await o.update(t.value,r),i.success("保存成功")):(await o.create(r),i.success("创建成功"),c.push("/ads"))}catch{i.error(p.value?"保存失败":"创建失败")}finally{e.value=!1}}async function _(){var a;if(!await((a=g.value)==null?void 0:a.validate())){i.warning("请填写必填字段");return}v.value=!0;try{const r=m.value;if(p.value)await o.update(t.value,r),await o.publish(t.value),i.success("发布成功"),c.push("/ads");else{const k=await o.create(r);await o.publish(k.id),i.success("发布成功"),c.push("/ads")}}catch{i.error("发布失败")}finally{v.value=!1}}function h(){c.push("/ads")}return M(()=>{u()}),(l,a)=>{const r=U("ElButton"),k=U("ElCard"),R=P("loading");return b(),T("div",H,[w("div",J,[w("h1",K,L(p.value?"编辑广告":"新建广告"),1),w("div",Q,[s(r,{onClick:h},{default:d(()=>[...a[1]||(a[1]=[E("取消",-1)])]),_:1}),s(r,{type:"default",loading:e.value,onClick:V},{default:d(()=>[...a[2]||(a[2]=[E(" 保存草稿 ",-1)])]),_:1},8,["loading"]),s(r,{type:"primary",loading:v.value,onClick:_},{default:d(()=>[...a[3]||(a[3]=[E(" 发布 ",-1)])]),_:1},8,["loading"])])]),j((b(),F(k,{shadow:"never"},{default:d(()=>[s(G,{ref_key:"formRef",ref:g,modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=D=>m.value=D)},null,8,["modelValue"])]),_:1})),[[R,n.value]])])}}}),te=B(W,[["__scopeId","data-v-bd7fd96f"]]);export{te as default};
