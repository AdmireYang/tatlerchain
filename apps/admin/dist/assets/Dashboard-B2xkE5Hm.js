import{ax as G,r as T,v as D,c as N,ab as i,y,z as v,D as e,E as b,F as Q,C as t,P as q,R as w,aE as H,j as O,n as z,_ as J,W as K,h as R,B as P,aB as M,u as E,Q as g,O as I}from"./vue-vendor-CaWn4O-h.js";import{g as V}from"./index-Bq8XV1Pd.js";import{b as X,h as U,j as Y,v as j,k as Z,m as tt,E as W}from"./element-plus-Cl1iFrzV.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i as et}from"./echarts-C3W-oE5n.js";const at=()=>V("/backstage/dashboard"),st=()=>V("/backstage/dashboard/posts"),lt=()=>V("/backstage/dashboard/ads"),ot=G("dashboard",()=>{const o=T(null),u=T(null),s=T(!1),n=T(null);return{postsStats:o,adsStats:u,loading:s,error:n,fetchOverview:async()=>{s.value=!0,n.value=null;try{const a=await at();o.value=a.posts,u.value=a.ads}catch(a){const l=a instanceof Error?a.message:"获取统计数据失败";throw n.value=l,a}finally{s.value=!1}},fetchPostsStats:async()=>{s.value=!0,n.value=null;try{const a=await st();o.value=a}catch(a){const l=a instanceof Error?a.message:"获取推文统计数据失败";throw n.value=l,a}finally{s.value=!1}},fetchAdsStats:async()=>{s.value=!0,n.value=null;try{const a=await lt();u.value=a}catch(a){const l=a instanceof Error?a.message:"获取广告统计数据失败";throw n.value=l,a}finally{s.value=!1}},reset:()=>{o.value=null,u.value=null,s.value=!1,n.value=null}}}),nt={class:"stat-card-content"},rt={class:"stat-info"},dt={class:"stat-title"},it={class:"stat-value"},ct=D({__name:"StatCard",props:{title:{},value:{},icon:{},color:{default:"#409eff"}},setup(o){const u=o,s=N(()=>typeof u.value=="number"?u.value.toLocaleString():u.value);return(n,c)=>{const r=i("ElIcon"),d=i("ElCard");return v(),y(d,{class:"stat-card","body-style":{padding:"20px"}},{default:e(()=>[b("div",nt,[b("div",{class:"stat-icon",style:Q({backgroundColor:o.color+"20",color:o.color})},[t(r,{size:32},{default:e(()=>[(v(),y(q(o.icon)))]),_:1})],4),b("div",rt,[b("div",dt,w(o.title),1),b("div",it,w(s.value),1)])])]),_:1})}}}),C=$(ct,[["__scopeId","data-v-a5864d28"]]),ut=D({__name:"TrendChart",props:{data:{},type:{default:"line"},height:{default:"300px"},color:{default:"#409eff"}},setup(o,{expose:u}){H(p=>({v8540e038:p.height}));const s=o,n=T();let c=null;const r=()=>{if(!n.value)return;c&&c.dispose(),c=et(n.value);const p={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:s.data.labels,boundaryGap:s.type==="bar",axisLine:{lineStyle:{color:"#e4e7ed"}},axisLabel:{color:"#606266"}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#606266"},splitLine:{lineStyle:{color:"#e4e7ed",type:"dashed"}}},series:[{name:s.data.name||"数据",type:s.type,data:s.data.values,smooth:s.type==="line",itemStyle:{color:s.color},areaStyle:s.type==="line"?{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:s.color+"40"},{offset:1,color:s.color+"00"}]}}:void 0}]};c.setOption(p)},d=()=>{c==null||c.resize()};return u({resize:d}),O(()=>{z(()=>{r(),window.addEventListener("resize",d)})}),J(()=>{z(()=>{d()})}),K(()=>{window.removeEventListener("resize",d),c&&(c.dispose(),c=null)}),R(()=>s.data,()=>{z(()=>{r()})},{deep:!0}),R(()=>s.type,()=>{z(()=>{r()})}),(p,a)=>(v(),P("div",{ref_key:"chartRef",ref:n,class:"trend-chart"},null,512))}}),pt=$(ut,[["__scopeId","data-v-4183b2ba"]]),ft={class:"posts-dashboard"},mt=D({__name:"PostsDashboard",props:{stats:{}},setup(o){const u=M(),s="http://localhost:3004",n=o,c=N(()=>{var a;return!((a=n.stats)!=null&&a.trend)||n.stats.trend.length===0?null:{labels:n.stats.trend.map(l=>{const _=new Date(l.date);return`${_.getMonth()+1}/${_.getDate()}`}),values:n.stats.trend.map(l=>l.count),name:"发布数量"}}),r=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",d=(a,l)=>{const _=`${s}/post/${l||a}`;window.open(_,"_blank")},p=a=>{u.push(`/posts/edit/${a}`)};return(a,l)=>{const _=i("ElCol"),S=i("ElRow"),A=i("ElEmpty"),L=i("ElCard"),x=i("ElTableColumn"),f=i("ElTag"),h=i("ElButton"),B=i("ElTable");return v(),P("div",ft,[t(S,{gutter:16,class:"mb-4"},{default:e(()=>[t(_,{xs:24,sm:12,md:6},{default:e(()=>{var m;return[t(C,{title:"推文总数",value:((m=o.stats)==null?void 0:m.total)||0,icon:E(X),color:"#409eff"},null,8,["value","icon"])]}),_:1}),t(_,{xs:24,sm:12,md:6},{default:e(()=>{var m;return[t(C,{title:"已发布",value:((m=o.stats)==null?void 0:m.published)||0,icon:E(U),color:"#67c23a"},null,8,["value","icon"])]}),_:1}),t(_,{xs:24,sm:12,md:6},{default:e(()=>{var m;return[t(C,{title:"草稿",value:((m=o.stats)==null?void 0:m.draft)||0,icon:E(Y),color:"#e6a23c"},null,8,["value","icon"])]}),_:1}),t(_,{xs:24,sm:12,md:6},{default:e(()=>{var m;return[t(C,{title:"总浏览量",value:((m=o.stats)==null?void 0:m.totalViews)||0,icon:E(j),color:"#f56c6c"},null,8,["value","icon"])]}),_:1})]),_:1}),t(S,{gutter:16,class:"mb-4"},{default:e(()=>[t(_,{span:24},{default:e(()=>[t(L,null,{header:e(()=>[...l[0]||(l[0]=[b("div",{class:"card-header"},[b("span",null,"推文发布趋势（最近 7 天）")],-1)])]),default:e(()=>[c.value?(v(),y(pt,{key:0,data:c.value,type:"line",color:"#409eff",height:"300px"},null,8,["data"])):(v(),y(A,{key:1,description:"暂无数据"}))]),_:1})]),_:1})]),_:1}),t(S,{gutter:16},{default:e(()=>[t(_,{span:24},{default:e(()=>[t(L,null,{header:e(()=>[...l[1]||(l[1]=[b("div",{class:"card-header"},[b("span",null,"最受欢迎的推文（Top 10）")],-1)])]),default:e(()=>{var m;return[(m=o.stats)!=null&&m.topPosts&&o.stats.topPosts.length>0?(v(),y(B,{key:0,data:o.stats.topPosts,stripe:""},{default:e(()=>[t(x,{type:"index",label:"排名",width:"80"}),t(x,{prop:"title",label:"标题","min-width":"200"}),t(x,{prop:"viewCount",label:"浏览量",width:"120",align:"right"},{default:e(({row:k})=>[t(f,{type:"danger"},{default:e(()=>[g(w(k.viewCount.toLocaleString()),1)]),_:2},1024)]),_:1}),t(x,{prop:"publishedAt",label:"发布时间",width:"180"},{default:e(({row:k})=>[g(w(r(k.publishedAt)),1)]),_:1}),t(x,{label:"操作",width:"150",fixed:"right"},{default:e(({row:k})=>[t(h,{type:"primary",size:"small",text:"",onClick:F=>d(k.id,k.slug)},{default:e(()=>[...l[2]||(l[2]=[g(" 预览 ",-1)])]),_:1},8,["onClick"]),t(h,{type:"primary",size:"small",text:"",onClick:F=>p(k.id)},{default:e(()=>[...l[3]||(l[3]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(v(),y(A,{key:1,description:"暂无数据"}))]}),_:1})]),_:1})]),_:1})])}}}),vt=$(mt,[["__scopeId","data-v-9051873f"]]),_t={class:"ads-dashboard"},ht=D({__name:"AdsDashboard",props:{stats:{}},setup(o){const u=M(),s=r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",n=r=>{if(!r){W.warning("该广告没有设置链接");return}window.open(r,"_blank")},c=r=>{u.push(`/ads/edit/${r}`)};return(r,d)=>{const p=i("ElCol"),a=i("ElRow"),l=i("ElTableColumn"),_=i("ElTag"),S=i("ElButton"),A=i("ElTable"),L=i("ElEmpty"),x=i("ElCard");return v(),P("div",_t,[t(a,{gutter:16,class:"mb-4"},{default:e(()=>[t(p,{xs:24,sm:12,md:6},{default:e(()=>{var f;return[t(C,{title:"广告总数",value:((f=o.stats)==null?void 0:f.total)||0,icon:E(Z),color:"#409eff"},null,8,["value","icon"])]}),_:1}),t(p,{xs:24,sm:12,md:6},{default:e(()=>{var f;return[t(C,{title:"活跃广告",value:((f=o.stats)==null?void 0:f.active)||0,icon:E(U),color:"#67c23a"},null,8,["value","icon"])]}),_:1}),t(p,{xs:24,sm:12,md:6},{default:e(()=>{var f;return[t(C,{title:"总点击次数",value:((f=o.stats)==null?void 0:f.totalClicks)||0,icon:E(tt),color:"#e6a23c"},null,8,["value","icon"])]}),_:1}),t(p,{xs:24,sm:12,md:6},{default:e(()=>{var f;return[t(C,{title:"总展示次数",value:((f=o.stats)==null?void 0:f.totalImpressions)||0,icon:E(j),color:"#f56c6c"},null,8,["value","icon"])]}),_:1})]),_:1}),t(a,{gutter:16},{default:e(()=>[t(p,{span:24},{default:e(()=>[t(x,null,{header:e(()=>[...d[0]||(d[0]=[b("div",{class:"card-header"},[b("span",null,"表现最好的广告（Top 10）")],-1)])]),default:e(()=>{var f;return[(f=o.stats)!=null&&f.topAds&&o.stats.topAds.length>0?(v(),y(A,{key:0,data:o.stats.topAds,stripe:""},{default:e(()=>[t(l,{type:"index",label:"排名",width:"80"}),t(l,{prop:"title",label:"标题","min-width":"200"}),t(l,{prop:"clickCount",label:"点击次数",width:"120",align:"right"},{default:e(({row:h})=>[g(w(h.clickCount.toLocaleString()),1)]),_:1}),t(l,{prop:"impressionCount",label:"展示次数",width:"120",align:"right"},{default:e(({row:h})=>[g(w(h.impressionCount.toLocaleString()),1)]),_:1}),t(l,{prop:"ctr",label:"点击率",width:"100",align:"right"},{default:e(({row:h})=>[t(_,{type:"success"},{default:e(()=>[g(w(h.ctr)+"%",1)]),_:2},1024)]),_:1}),t(l,{prop:"publishedAt",label:"发布时间",width:"180"},{default:e(({row:h})=>[g(w(s(h.publishedAt)),1)]),_:1}),t(l,{label:"操作",width:"150",fixed:"right"},{default:e(({row:h})=>[t(S,{type:"primary",size:"small",text:"",onClick:B=>n(h.linkUrl)},{default:e(()=>[...d[1]||(d[1]=[g(" 预览 ",-1)])]),_:1},8,["onClick"]),t(S,{type:"primary",size:"small",text:"",onClick:B=>c(h.id)},{default:e(()=>[...d[2]||(d[2]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(v(),y(L,{key:1,description:"暂无数据"}))]}),_:1})]),_:1})]),_:1})])}}}),bt=$(ht,[["__scopeId","data-v-33df3037"]]),gt={class:"dashboard-page"},yt=D({__name:"Dashboard",setup(o){const u=ot(),s=T("posts"),n=async()=>{try{await u.fetchOverview()}catch(r){W.error(r.message||"加载数据失败")}},c=r=>{console.log("切换到标签页:",r)};return O(()=>{n()}),(r,d)=>{const p=i("ElTabPane"),a=i("ElTabs");return v(),P("div",gt,[d[1]||(d[1]=b("h1",{class:"text-2xl font-bold mb-4"},"数据看板",-1)),t(a,{modelValue:s.value,"onUpdate:modelValue":d[0]||(d[0]=l=>s.value=l),onTabChange:c},{default:e(()=>[t(p,{label:"推文看板",name:"posts"},{default:e(()=>[s.value==="posts"?(v(),y(vt,{key:0,stats:E(u).postsStats},null,8,["stats"])):I("",!0)]),_:1}),t(p,{label:"广告看板",name:"ads"},{default:e(()=>[s.value==="ads"?(v(),y(bt,{key:0,stats:E(u).adsStats},null,8,["stats"])):I("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),St=$(yt,[["__scopeId","data-v-9c645347"]]);export{St as default};
