import{aa as M,d as N,r as i,O as D,e as c,f as y,o as f,h as I,q as V,i as u,w as v,x as L,t as x,p as R,J as W,s as w,z as q,ab as H,E as h}from"./index-B14LQPlx.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";function $(e,p){const t=new FormData;return t.append("file",e),M.post("/backstage/upload/image",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{if(p&&a.total){const g=Math.round(a.loaded*100/a.total);p(g)}}})}const A={class:"image-upload"},F={class:"upload-area"},J={key:0,class:"image-preview"},O={class:"image-error"},P={key:1,class:"upload-tip"},j=N({__name:"ImageUpload",props:{modelValue:{default:""},placeholder:{default:"请输入图片 URL 或上传图片"},accept:{default:"image/*"},maxSize:{default:5},previewWidth:{default:"200px"},previewHeight:{default:"120px"},clearable:{type:Boolean,default:!0},tip:{default:""}},emits:["update:modelValue","upload-success","upload-error"],setup(e,{emit:p}){const t=e,a=p,g=i(),o=i(t.modelValue),n=i(!1),m=i(0),b=i("");D(()=>t.modelValue,l=>{o.value=l});function E(l){a("update:modelValue",l)}function U(l){return l.type.startsWith("image/")?l.size/1024/1024<t.maxSize?!0:(h.error(`图片大小不能超过 ${t.maxSize}MB`),!1):(h.error("只能上传图片文件"),!1)}async function k(l){const s=l.file;n.value=!0,m.value=0;try{const d=(await $(s,_=>{m.value=_})).data.data.url;o.value=d,a("update:modelValue",d),a("upload-success",d),h.success("上传成功")}catch(r){console.error("上传失败:",r),a("upload-error",r),h.error("上传失败")}finally{n.value=!1,m.value=0}}function z(){o.value="",a("update:modelValue","")}return(l,s)=>{const r=c("ElInput"),d=c("ElButton"),_=c("ElUpload"),B=c("ElIcon"),C=c("ElImage");return f(),y("div",A,[I("div",F,[u(r,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=S=>o.value=S),placeholder:e.placeholder,disabled:n.value,onInput:E},null,8,["modelValue","placeholder","disabled"]),u(_,{ref_key:"uploadRef",ref:g,action:b.value,"show-file-list":!1,"before-upload":U,"http-request":k,disabled:n.value},{default:v(()=>[u(d,{type:"primary",loading:n.value},{default:v(()=>[L(x(n.value?`上传中 ${m.value}%`:"上传图片"),1)]),_:1},8,["loading"])]),_:1},8,["action","disabled"])]),o.value?(f(),y("div",J,[u(C,{src:o.value,fit:"cover",style:W({width:e.previewWidth,height:e.previewHeight})},{error:v(()=>[I("div",O,[u(B,null,{default:v(()=>[u(w(q))]),_:1}),s[1]||(s[1]=I("span",null,"加载失败",-1))])]),_:1},8,["src","style"]),e.clearable?(f(),R(d,{key:0,class:"clear-btn",type:"danger",size:"small",circle:"",icon:w(H),onClick:z},null,8,["icon"])):V("",!0)])):V("",!0),e.tip?(f(),y("div",P,x(e.tip),1)):V("",!0)])}}}),Q=T(j,[["__scopeId","data-v-cdcef7f5"]]);export{Q as I};
