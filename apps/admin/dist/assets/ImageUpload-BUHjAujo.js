import{aa as M,d as D,r as i,P as N,e as c,f as y,o as f,g as I,v as V,i as u,w as v,y as L,D as w,t as R,K as W,j as x,A,ab as H,E as g}from"./index-C6hz40a1.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";function T(e,p){const t=new FormData;return t.append("file",e),M.post("/backstage/upload/image",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a=>{if(p&&a.total){const h=Math.round(a.loaded*100/a.total);p(h)}}})}const $={class:"image-upload"},j={class:"upload-area"},q={key:0,class:"image-preview"},F={class:"image-error"},K={key:1,class:"upload-tip"},G=D({__name:"ImageUpload",props:{modelValue:{default:""},placeholder:{default:"请输入图片 URL 或上传图片"},accept:{default:"image/*"},maxSize:{default:5},previewWidth:{default:"200px"},previewHeight:{default:"120px"},clearable:{type:Boolean,default:!0},tip:{default:""}},emits:["update:modelValue","upload-success","upload-error"],setup(e,{emit:p}){const t=e,a=p,h=i(),o=i(t.modelValue),n=i(!1),m=i(0),b=i("");N(()=>t.modelValue,l=>{o.value=l});function E(l){a("update:modelValue",l)}function U(l){return l.type.startsWith("image/")?l.size/1024/1024<t.maxSize?!0:(g.error(`图片大小不能超过 ${t.maxSize}MB`),!1):(g.error("只能上传图片文件"),!1)}async function k(l){const s=l.file;n.value=!0,m.value=0;try{const d=(await T(s,_=>{m.value=_})).data.data.url;o.value=d,a("update:modelValue",d),a("upload-success",d),g.success("上传成功")}catch(r){console.error("上传失败:",r),a("upload-error",r),g.error("上传失败")}finally{n.value=!1,m.value=0}}function z(){o.value="",a("update:modelValue","")}return(l,s)=>{const r=c("ElInput"),d=c("ElButton"),_=c("ElUpload"),B=c("ElIcon"),C=c("ElImage");return f(),y("div",$,[I("div",j,[u(r,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=S=>o.value=S),placeholder:e.placeholder,disabled:n.value,onInput:E},null,8,["modelValue","placeholder","disabled"]),u(_,{ref_key:"uploadRef",ref:h,action:b.value,"show-file-list":!1,"before-upload":U,"http-request":k,disabled:n.value},{default:v(()=>[u(d,{type:"primary",loading:n.value},{default:v(()=>[L(w(n.value?`上传中 ${m.value}%`:"上传图片"),1)]),_:1},8,["loading"])]),_:1},8,["action","disabled"])]),o.value?(f(),y("div",q,[u(C,{src:o.value,fit:"cover",style:W({width:e.previewWidth,height:e.previewHeight})},{error:v(()=>[I("div",F,[u(B,null,{default:v(()=>[u(x(A))]),_:1}),s[1]||(s[1]=I("span",null,"加载失败",-1))])]),_:1},8,["src","style"]),e.clearable?(f(),R(d,{key:0,class:"clear-btn",type:"danger",size:"small",circle:"",icon:x(H),onClick:z},null,8,["icon"])):V("",!0)])):V("",!0),e.tip?(f(),y("div",K,w(e.tip),1)):V("",!0)])}}}),Q=P(G,[["__scopeId","data-v-cdcef7f5"]]);export{Q as I};
