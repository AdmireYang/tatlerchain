import{n as re,g as de,E as k}from"./element-plus-Cl1iFrzV.js";import{s as x,u as ie}from"./index-DBOFIeWp.js";import{ax as ue,r as w,v as pe,c as me,l as F,j as fe,ab as d,ac as ce,B as R,z as E,E as P,C as a,D as l,Q as u,u as p,M as ge,O as q,y as N,R as ve,k as j}from"./vue-vendor-CaWn4O-h.js";import{u as we}from"./useTable-Dn0_eMR9.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";function L(r){return x.get("/backstage/users",{params:r})}function _e(r){return x.get(`/backstage/users/${r}`)}function be(r){return x.post("/backstage/users",r)}function Ee(r,m){return x.put(`/backstage/users/${r}`,m)}function Ce(r){return x.delete(`/backstage/users/${r}`)}const Ve=ue("user",()=>{const r=w([]),m=w(null),c=w(!1);async function I(n){c.value=!0;try{const i=await L(n);return r.value=i.data.data,i.data}finally{c.value=!1}}async function g(n){c.value=!0;try{const i=await _e(n);return m.value=i.data.data,i.data.data}finally{c.value=!1}}async function h(n){return(await be(n)).data.data}async function S(n,i){return(await Ee(n,i)).data.data}async function z(n){await Ce(n)}return{users:r,currentUser:m,loading:c,fetchUsers:I,fetchUserById:g,create:h,update:S,remove:z}}),ke={class:"users-page"},xe={class:"page-header"},he={key:0,class:"pagination-wrapper"},De={key:0,style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},Ue=pe({__name:"Users",setup(r){const m=Ve(),c=ie(),I=me(()=>{var o;return(o=c.user)==null?void 0:o.id}),g=F({role:void 0}),{data:h,total:S,loading:z,page:n,pageSize:i,fetchData:y,handlePageChange:Q,handlePageSizeChange:Z}=we(o=>L({...o,...g})),_=w(!1),f=w(!1),T=w(!1),D=w(),t=F({id:"",name:"",email:"",password:"",role:"EDITOR"}),G={email:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,message:"账号长度至少3位",trigger:"blur"},{max:50,message:"账号长度不能超过50位",trigger:"blur"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"账号只能包含字母、数字、下划线和横线",trigger:"blur"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{validator:(o,e,C)=>{!f.value&&!e?C(new Error("请输入密码")):e&&e!=="******"&&e.length<6?C(new Error("密码长度至少6位")):C()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]},H=o=>new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),J=()=>{n.value=1,y()},K=()=>{g.role=void 0,n.value=1,y()},W=()=>{f.value=!1,_.value=!0},X=o=>{f.value=!0,t.id=o.id,t.name=o.name,t.email=o.email,t.password="******",t.role=o.role,_.value=!0},Y=async o=>{try{await de.confirm(`确定要删除账号"${o.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await m.remove(o.id),k.success("删除成功"),y()}catch(e){e!=="cancel"&&k.error(e.message||"删除失败")}},ee=async()=>{if(D.value)try{if(await D.value.validate(),T.value=!0,f.value){const o={name:t.name,email:t.email,role:t.role};t.password&&t.password!=="******"&&(o.password=t.password),await m.update(t.id,o),k.success("更新成功")}else await m.create({name:t.name,email:t.email,password:t.password,role:t.role}),k.success("创建成功");_.value=!1,y()}catch(o){o!==!1&&k.error(o.message||(f.value?"更新失败":"创建失败"))}finally{T.value=!1}},ae=()=>{var o;(o=D.value)==null||o.resetFields(),t.id="",t.name="",t.email="",t.password="",t.role="EDITOR"};return fe(()=>{y()}),(o,e)=>{const C=d("ElIcon"),v=d("ElButton"),U=d("ElOption"),$=d("ElSelect"),b=d("ElFormItem"),A=d("ElForm"),M=d("ElCard"),V=d("ElTableColumn"),O=d("ElTag"),te=d("ElTable"),le=d("ElPagination"),B=d("ElInput"),oe=d("ElDialog"),se=ce("loading");return E(),R("div",ke,[P("div",xe,[e[10]||(e[10]=P("h1",{class:"text-2xl font-bold"},"账号管理",-1)),a(v,{type:"primary",onClick:W},{default:l(()=>[a(C,null,{default:l(()=>[a(p(re))]),_:1}),e[9]||(e[9]=u(" 新建账号 ",-1))]),_:1})]),a(M,{class:"filter-card",shadow:"never"},{default:l(()=>[a(A,{inline:!0,model:g},{default:l(()=>[a(b,{label:"角色"},{default:l(()=>[a($,{modelValue:g.role,"onUpdate:modelValue":e[0]||(e[0]=s=>g.role=s),placeholder:"全部角色",clearable:"",style:{width:"150px"}},{default:l(()=>[a(U,{label:"管理员",value:"ADMIN"}),a(U,{label:"编辑",value:"EDITOR"})]),_:1},8,["modelValue"])]),_:1}),a(b,null,{default:l(()=>[a(v,{type:"primary",onClick:J},{default:l(()=>[...e[11]||(e[11]=[u("查询",-1)])]),_:1}),a(v,{onClick:K},{default:l(()=>[...e[12]||(e[12]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(M,{class:"list-card",shadow:"never"},{default:l(()=>[ge((E(),N(te,{data:p(h),stripe:""},{default:l(()=>[a(V,{prop:"email",label:"账号","min-width":"150"}),a(V,{prop:"name",label:"用户名","min-width":"120"}),a(V,{prop:"role",label:"角色",width:"100"},{default:l(({row:s})=>[s.role==="ADMIN"?(E(),N(O,{key:0,type:"danger"},{default:l(()=>[...e[13]||(e[13]=[u("管理员",-1)])]),_:1})):(E(),N(O,{key:1,type:"info"},{default:l(()=>[...e[14]||(e[14]=[u("编辑",-1)])]),_:1}))]),_:1}),a(V,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:s})=>[u(ve(H(s.createdAt)),1)]),_:1}),a(V,{label:"操作",width:"180",fixed:"right"},{default:l(({row:s})=>[a(v,{size:"small",type:"primary",text:"",onClick:ne=>X(s)},{default:l(()=>[...e[15]||(e[15]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(v,{size:"small",type:"danger",text:"",disabled:s.id===I.value,onClick:ne=>Y(s)},{default:l(()=>[...e[16]||(e[16]=[u(" 删除 ",-1)])]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["data"])),[[se,p(z)]]),p(h).length>0?(E(),R("div",he,[a(le,{"current-page":p(n),"onUpdate:currentPage":e[1]||(e[1]=s=>j(n)?n.value=s:null),"page-size":p(i),"onUpdate:pageSize":e[2]||(e[2]=s=>j(i)?i.value=s:null),total:p(S),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:p(Q),onSizeChange:p(Z)},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])])):q("",!0)]),_:1}),a(oe,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=s=>_.value=s),title:f.value?"编辑账号":"新建账号",width:"500px",onClose:ae},{footer:l(()=>[a(v,{onClick:e[7]||(e[7]=s=>_.value=!1)},{default:l(()=>[...e[17]||(e[17]=[u("取消",-1)])]),_:1}),a(v,{type:"primary",loading:T.value,onClick:ee},{default:l(()=>[...e[18]||(e[18]=[u("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(A,{ref_key:"formRef",ref:D,model:t,rules:G,"label-width":"80px","label-position":"right"},{default:l(()=>[a(b,{label:"账号",prop:"email"},{default:l(()=>[a(B,{modelValue:t.email,"onUpdate:modelValue":e[3]||(e[3]=s=>t.email=s),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),a(b,{label:"用户名",prop:"name"},{default:l(()=>[a(B,{modelValue:t.name,"onUpdate:modelValue":e[4]||(e[4]=s=>t.name=s),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(b,{label:"密码",prop:"password"},{default:l(()=>[a(B,{modelValue:t.password,"onUpdate:modelValue":e[5]||(e[5]=s=>t.password=s),type:"password",placeholder:f.value?"不修改请保持默认值":"请输入密码","show-password":""},null,8,["modelValue","placeholder"]),f.value?(E(),R("div",De," 提示：如需修改密码请清空后重新输入，否则保持默认值不修改 ")):q("",!0)]),_:1}),a(b,{label:"角色",prop:"role"},{default:l(()=>[a($,{modelValue:t.role,"onUpdate:modelValue":e[6]||(e[6]=s=>t.role=s),placeholder:"请选择角色",style:{width:"100%"}},{default:l(()=>[a(U,{label:"管理员",value:"ADMIN"}),a(U,{label:"编辑",value:"EDITOR"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Re=ye(Ue,[["__scopeId","data-v-c5a6c9bb"]]);export{Re as default};
