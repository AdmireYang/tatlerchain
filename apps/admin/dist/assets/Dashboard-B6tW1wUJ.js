import{ax as O,r as w,v as C,c as L,ab as f,y as h,z as m,D as e,E as u,F as B,C as t,P as M,R as y,aE as j,j as V,n as S,_ as U,W as F,h as P,B as k,u as g,Q as x,O as z}from"./vue-vendor-C3C-az8a.js";import{g as $}from"./index-DNHOLSe2.js";import{b as G,h as R,j as Q,v as I,k as W,m as q,E as H}from"./element-plus-B8SKDpVE.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{i as J}from"./echarts-C3W-oE5n.js";const K=()=>$("/backstage/dashboard"),X=()=>$("/backstage/dashboard/posts"),Y=()=>$("/backstage/dashboard/ads"),Z=O("dashboard",()=>{const o=w(null),c=w(null),a=w(!1),i=w(null);return{postsStats:o,adsStats:c,loading:a,error:i,fetchOverview:async()=>{a.value=!0,i.value=null;try{const d=await K();o.value=d.posts,c.value=d.ads}catch(d){const v=d instanceof Error?d.message:"获取统计数据失败";throw i.value=v,d}finally{a.value=!1}},fetchPostsStats:async()=>{a.value=!0,i.value=null;try{const d=await X();o.value=d}catch(d){const v=d instanceof Error?d.message:"获取推文统计数据失败";throw i.value=v,d}finally{a.value=!1}},fetchAdsStats:async()=>{a.value=!0,i.value=null;try{const d=await Y();c.value=d}catch(d){const v=d instanceof Error?d.message:"获取广告统计数据失败";throw i.value=v,d}finally{a.value=!1}},reset:()=>{o.value=null,c.value=null,a.value=!1,i.value=null}}}),tt={class:"stat-card-content"},et={class:"stat-info"},at={class:"stat-title"},st={class:"stat-value"},lt=C({__name:"StatCard",props:{title:{},value:{},icon:{},color:{default:"#409eff"}},setup(o){const c=o,a=L(()=>typeof c.value=="number"?c.value.toLocaleString():c.value);return(i,r)=>{const s=f("ElIcon"),l=f("ElCard");return m(),h(l,{class:"stat-card","body-style":{padding:"20px"}},{default:e(()=>[u("div",tt,[u("div",{class:"stat-icon",style:B({backgroundColor:o.color+"20",color:o.color})},[t(s,{size:32},{default:e(()=>[(m(),h(M(o.icon)))]),_:1})],4),u("div",et,[u("div",at,y(o.title),1),u("div",st,y(a.value),1)])])]),_:1})}}}),E=T(lt,[["__scopeId","data-v-a5864d28"]]),ot=C({__name:"TrendChart",props:{data:{},type:{default:"line"},height:{default:"300px"},color:{default:"#409eff"}},setup(o,{expose:c}){j(p=>({v8540e038:p.height}));const a=o,i=w();let r=null;const s=()=>{if(!i.value)return;r&&r.dispose(),r=J(i.value);const p={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:a.data.labels,boundaryGap:a.type==="bar",axisLine:{lineStyle:{color:"#e4e7ed"}},axisLabel:{color:"#606266"}},yAxis:{type:"value",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{color:"#606266"},splitLine:{lineStyle:{color:"#e4e7ed",type:"dashed"}}},series:[{name:a.data.name||"数据",type:a.type,data:a.data.values,smooth:a.type==="line",itemStyle:{color:a.color},areaStyle:a.type==="line"?{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:a.color+"40"},{offset:1,color:a.color+"00"}]}}:void 0}]};r.setOption(p)},l=()=>{r==null||r.resize()};return c({resize:l}),V(()=>{S(()=>{s(),window.addEventListener("resize",l)})}),U(()=>{S(()=>{l()})}),F(()=>{window.removeEventListener("resize",l),r&&(r.dispose(),r=null)}),P(()=>a.data,()=>{S(()=>{s()})},{deep:!0}),P(()=>a.type,()=>{S(()=>{s()})}),(p,d)=>(m(),k("div",{ref_key:"chartRef",ref:i,class:"trend-chart"},null,512))}}),N=T(ot,[["__scopeId","data-v-4183b2ba"]]),nt={class:"posts-dashboard"},rt=C({__name:"PostsDashboard",props:{stats:{}},setup(o){const c=o,a=L(()=>{var r;return!((r=c.stats)!=null&&r.trend)||c.stats.trend.length===0?null:{labels:c.stats.trend.map(s=>{const l=new Date(s.date);return`${l.getMonth()+1}/${l.getDate()}`}),values:c.stats.trend.map(s=>s.count),name:"发布数量"}}),i=r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return(r,s)=>{const l=f("ElCol"),p=f("ElRow"),d=f("ElEmpty"),v=f("ElCard"),_=f("ElTableColumn"),D=f("ElTag"),A=f("ElTable");return m(),k("div",nt,[t(p,{gutter:16,class:"mb-4"},{default:e(()=>[t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"推文总数",value:((n=o.stats)==null?void 0:n.total)||0,icon:g(G),color:"#409eff"},null,8,["value","icon"])]}),_:1}),t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"已发布",value:((n=o.stats)==null?void 0:n.published)||0,icon:g(R),color:"#67c23a"},null,8,["value","icon"])]}),_:1}),t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"草稿",value:((n=o.stats)==null?void 0:n.draft)||0,icon:g(Q),color:"#e6a23c"},null,8,["value","icon"])]}),_:1}),t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"总浏览量",value:((n=o.stats)==null?void 0:n.totalViews)||0,icon:g(I),color:"#f56c6c"},null,8,["value","icon"])]}),_:1})]),_:1}),t(p,{gutter:16,class:"mb-4"},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(v,null,{header:e(()=>[...s[0]||(s[0]=[u("div",{class:"card-header"},[u("span",null,"推文发布趋势（最近 7 天）")],-1)])]),default:e(()=>[a.value?(m(),h(N,{key:0,data:a.value,type:"line",color:"#409eff",height:"300px"},null,8,["data"])):(m(),h(d,{key:1,description:"暂无数据"}))]),_:1})]),_:1})]),_:1}),t(p,{gutter:16},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(v,null,{header:e(()=>[...s[1]||(s[1]=[u("div",{class:"card-header"},[u("span",null,"最受欢迎的推文（Top 10）")],-1)])]),default:e(()=>{var n;return[(n=o.stats)!=null&&n.topPosts&&o.stats.topPosts.length>0?(m(),h(A,{key:0,data:o.stats.topPosts,stripe:""},{default:e(()=>[t(_,{type:"index",label:"排名",width:"80"}),t(_,{prop:"title",label:"标题","min-width":"200"}),t(_,{prop:"viewCount",label:"浏览量",width:"120",align:"right"},{default:e(({row:b})=>[t(D,{type:"danger"},{default:e(()=>[x(y(b.viewCount.toLocaleString()),1)]),_:2},1024)]),_:1}),t(_,{prop:"publishedAt",label:"发布时间",width:"180"},{default:e(({row:b})=>[x(y(i(b.publishedAt)),1)]),_:1})]),_:1},8,["data"])):(m(),h(d,{key:1,description:"暂无数据"}))]}),_:1})]),_:1})]),_:1})])}}}),dt=T(rt,[["__scopeId","data-v-32cbe840"]]),ct={class:"ads-dashboard"},it={class:"ctr-display"},ut={class:"ctr-value"},ft={class:"chart-container"},pt=C({__name:"AdsDashboard",props:{stats:{}},setup(o){const c=o,a=L(()=>{var r;return!((r=c.stats)!=null&&r.trend)||c.stats.trend.length===0?null:{labels:c.stats.trend.map(s=>{const l=new Date(s.date);return`${l.getMonth()+1}/${l.getDate()}`}),values:c.stats.trend.map(s=>s.ctr),name:"点击率 (%)"}}),i=r=>r?new Date(r).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return(r,s)=>{const l=f("ElCol"),p=f("ElRow"),d=f("ElCard"),v=f("ElEmpty"),_=f("ElTableColumn"),D=f("ElTag"),A=f("ElTable");return m(),k("div",ct,[t(p,{gutter:16,class:"mb-4"},{default:e(()=>[t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"广告总数",value:((n=o.stats)==null?void 0:n.total)||0,icon:g(W),color:"#409eff"},null,8,["value","icon"])]}),_:1}),t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"活跃广告",value:((n=o.stats)==null?void 0:n.active)||0,icon:g(R),color:"#67c23a"},null,8,["value","icon"])]}),_:1}),t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"总点击次数",value:((n=o.stats)==null?void 0:n.totalClicks)||0,icon:g(q),color:"#e6a23c"},null,8,["value","icon"])]}),_:1}),t(l,{xs:24,sm:12,md:6},{default:e(()=>{var n;return[t(E,{title:"总展示次数",value:((n=o.stats)==null?void 0:n.totalImpressions)||0,icon:g(I),color:"#f56c6c"},null,8,["value","icon"])]}),_:1})]),_:1}),t(p,{gutter:16,class:"mb-4"},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(d,null,{default:e(()=>{var n;return[u("div",it,[s[0]||(s[0]=u("div",{class:"ctr-label"},"平均点击率 (CTR)",-1)),u("div",ut,y(((n=o.stats)==null?void 0:n.ctr)||"0")+"%",1)])]}),_:1})]),_:1})]),_:1}),t(p,{gutter:16,class:"mb-4"},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(d,{shadow:"never"},{header:e(()=>[...s[1]||(s[1]=[u("div",{class:"card-header"},[u("span",null,"广告点击率趋势（最近 7 天）")],-1)])]),default:e(()=>[u("div",ft,[a.value?(m(),h(N,{key:0,data:a.value,type:"bar",color:"#67c23a",height:"300px"},null,8,["data"])):(m(),h(v,{key:1,description:"暂无数据"}))])]),_:1})]),_:1})]),_:1}),t(p,{gutter:16},{default:e(()=>[t(l,{span:24},{default:e(()=>[t(d,null,{header:e(()=>[...s[2]||(s[2]=[u("div",{class:"card-header"},[u("span",null,"表现最好的广告（Top 10）")],-1)])]),default:e(()=>{var n;return[(n=o.stats)!=null&&n.topAds&&o.stats.topAds.length>0?(m(),h(A,{key:0,data:o.stats.topAds,stripe:""},{default:e(()=>[t(_,{type:"index",label:"排名",width:"80"}),t(_,{prop:"title",label:"标题","min-width":"200"}),t(_,{prop:"clickCount",label:"点击次数",width:"120",align:"right"},{default:e(({row:b})=>[x(y(b.clickCount.toLocaleString()),1)]),_:1}),t(_,{prop:"impressionCount",label:"展示次数",width:"120",align:"right"},{default:e(({row:b})=>[x(y(b.impressionCount.toLocaleString()),1)]),_:1}),t(_,{prop:"ctr",label:"点击率",width:"100",align:"right"},{default:e(({row:b})=>[t(D,{type:"success"},{default:e(()=>[x(y(b.ctr)+"%",1)]),_:2},1024)]),_:1}),t(_,{prop:"publishedAt",label:"发布时间",width:"180"},{default:e(({row:b})=>[x(y(i(b.publishedAt)),1)]),_:1})]),_:1},8,["data"])):(m(),h(v,{key:1,description:"暂无数据"}))]}),_:1})]),_:1})]),_:1})])}}}),mt=T(pt,[["__scopeId","data-v-831cfb92"]]),vt={class:"dashboard-page"},ht=C({__name:"Dashboard",setup(o){const c=Z(),a=w("posts"),i=async()=>{try{await c.fetchOverview()}catch(s){H.error(s.message||"加载数据失败")}},r=s=>{console.log("切换到标签页:",s)};return V(()=>{i()}),(s,l)=>{const p=f("ElTabPane"),d=f("ElTabs");return m(),k("div",vt,[l[1]||(l[1]=u("h1",{class:"text-2xl font-bold mb-4"},"数据看板",-1)),t(d,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=v=>a.value=v),onTabChange:r},{default:e(()=>[t(p,{label:"推文看板",name:"posts"},{default:e(()=>[a.value==="posts"?(m(),h(dt,{key:0,stats:g(c).postsStats},null,8,["stats"])):z("",!0)]),_:1}),t(p,{label:"广告看板",name:"ads"},{default:e(()=>[a.value==="ads"?(m(),h(mt,{key:0,stats:g(c).adsStats},null,8,["stats"])):z("",!0)]),_:1})]),_:1},8,["modelValue"])])}}}),wt=T(ht,[["__scopeId","data-v-9c645347"]]);export{wt as default};
